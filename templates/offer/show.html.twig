{% extends 'base.html.twig' %}

{% block title %}Voir l'offre
{% endblock %}

{% block body %}

	<h1>{{ offer.name|capitalize }}</h1>
	<h2>Marque :
		{{ offer.brandId.name}}
	</h2>
	<div class="mb-3 card">

		<div class="card-body">
			<p>Nom :
				{{ offer.name|capitalize }}</p>
			<p>Description :
				{{ offer.description ? offer.description|slice(0, 50) : 'NC'}}
			</p>
			<p>Dates de début :
				{{ offer.dateStart ? offer.dateStart|date('d/m/Y') : 'NC'}}
			</p>
			<p>Dates de fin :
				{{ offer.dateEnd ? offer.dateEnd|date('d/m/Y') : 'NC'}}
			</p>
			<div class="card-action">
				{% for role in app.user.roles %}
					{% if role == "ROLE_INFLUENCEUR"  %}
						{% set newArray = [] %}
						{% set var = [] %}

						{% for app in offerApplied %}
							{% if app.offer.id not in newArray %}
								{% if app.offer.id  == offer.id %}
									<div class="mb-3">
										<mark>Vous avez deja postuler a cette offre</mark>
									</div>
									<div class="mb-3">
										{% if app.status == "pending" %}
											<p class="lead">En cours de traitement ✨</p>
										{% endif %}
									</div>
									{% set newArray = newArray|merge([app.offer.id]) %}
								{% endif %}
							{% endif %}
							{% if offer.id == app.offer.id %}
								{% set var = app.offer.id %}
							{% endif %}
						{% endfor %}

						{% if offer.id != var %}
							<a href="{{ path('offer_apply', {'id': offer.id}) }}" class="btn btn-success ">Postuler</a>
						{% endif %}

					{% endif %}
					{% if  role == "ROLE_MARQUE" %}
						{% if offer.brandId.id == brand.id  %}
							<a href="{{ path('offer_edit', {'id': offer.id}) }}" class="btn btn-success">Modifier l'offre</a>
							<a href="{{ path('offer_delete', {'id': offer.id, 'token': csrf_token('delete_offer' ~ offer.id)}) }}" class="btn btn-danger">Supprimer l'offre</a>
						{% endif %}
					{% endif %}
				{% endfor %}
			</div>
		</div>
	</div>
	<a href="{{ path('offer_index') }}" class="btn btn-primary">Toutes les offres</a>

{% endblock %}