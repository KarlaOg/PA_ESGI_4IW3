{% extends 'base.html.twig' %}

{% block title %}Hello WebsocketController!
{% endblock %}

{% block body %}
	<style>
		body {
			font-family: arial;
		}

		.form-group {
			margin-bottom: 10px;
		}

		input {
			border: solid lightgrey 1px;
			padding: 8px;
		}

		label {
			display: inline-block;
			min-width: 150px;
		}

		#chat {
			height: 400px;
			width: 600px;
			border: solid lightgrey 1px;
			overflow: auto;
			margin-bottom: 20px;
		}

		button {
			padding: 6px 12px;
		}

		.message {
			padding: 10px 5px;
			margin-bottom: 10px;
			border-bottom: solid lightgrey 1px;
		}
	</style>

	<link rel="stylesheet" href="{{ asset('css/chat.css') }}"/>

	<div class="container">
		<h3 class=" text-center">Messaging</h3>
		<div class="messaging">
			<div class="inbox_msg">
				<div class="inbox_people">
					<div class="headind_srch">
						<div class="recent_heading">
							<h4>Recent</h4>
						</div>
						<div class="srch_bar">
							<div class="stylish-input-group">
								<input type="text" class="search-bar" placeholder="Search">
								<span class="input-group-addon">
									<button type="button">
										<i class="fa fa-search" aria-hidden="true"></i>
									</button>
								</span>
							</div>
						</div>
					</div>
					<div class="inbox_chat">
						<div class="chat_list active_chat">
							<div class="chat_people">
								<div class="chat_img">
									<img src="https://ptetutorials.com/images/user-profile.png" alt="sunil">
								</div>
								<div class="chat_ib">
									<h5>Sunil Rajput
										<span class="chat_date">Dec 25</span>
									</h5>
									<p>Test, which is a new approach to have all solutions 
																																								                    astrology under one roof.</p>
								</div>
							</div>
						</div>
						<div class="chat_list">
							<div class="chat_people">
								<div class="chat_img">
									<img src="https://ptetutorials.com/images/user-profile.png" alt="sunil">
								</div>
								<div class="chat_ib">
									<h5>Sunil Rajput
										<span class="chat_date">Dec 25</span>
									</h5>
									<p>Test, which is a new approach to have all solutions 
																																								                    astrology under one roof.</p>
								</div>
							</div>
						</div>
						<div class="chat_list">
							<div class="chat_people">
								<div class="chat_img">
									<img src="https://ptetutorials.com/images/user-profile.png" alt="sunil">
								</div>
								<div class="chat_ib">
									<h5>Sunil Rajput
										<span class="chat_date">Dec 25</span>
									</h5>
									<p>Test, which is a new approach to have all solutions 
																																								                    astrology under one roof.</p>
								</div>
							</div>
						</div>
						<div class="chat_list">
							<div class="chat_people">
								<div class="chat_img">
									<img src="https://ptetutorials.com/images/user-profile.png" alt="sunil">
								</div>
								<div class="chat_ib">
									<h5>Sunil Rajput
										<span class="chat_date">Dec 25</span>
									</h5>
									<p>Test, which is a new approach to have all solutions 
																																								                    astrology under one roof.</p>
								</div>
							</div>
						</div>
						<div class="chat_list">
							<div class="chat_people">
								<div class="chat_img">
									<img src="https://ptetutorials.com/images/user-profile.png" alt="sunil">
								</div>
								<div class="chat_ib">
									<h5>Sunil Rajput
										<span class="chat_date">Dec 25</span>
									</h5>
									<p>Test, which is a new approach to have all solutions 
																																								                    astrology under one roof.</p>
								</div>
							</div>
						</div>
						<div class="chat_list">
							<div class="chat_people">
								<div class="chat_img">
									<img src="https://ptetutorials.com/images/user-profile.png" alt="sunil">
								</div>
								<div class="chat_ib">
									<h5>Sunil Rajput
										<span class="chat_date">Dec 25</span>
									</h5>
									<p>Test, which is a new approach to have all solutions 
																																								                    astrology under one roof.</p>
								</div>
							</div>
						</div>
						<div class="chat_list">
							<div class="chat_people">
								<div class="chat_img">
									<img src="https://ptetutorials.com/images/user-profile.png" alt="sunil">
								</div>
								<div class="chat_ib">
									<h5>Sunil Rajput
										<span class="chat_date">Dec 25</span>
									</h5>
									<p>Test, which is a new approach to have all solutions 
																																								                    astrology under one roof.</p>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="mesgs">
					<div class="msg_history">
						<div class="incoming_msg">
							<div class="incoming_msg_img">
								<img src="https://ptetutorials.com/images/user-profile.png" alt="sunil">
							</div>
							<div class="received_msg">
								<div class="received_withd_msg">
									<p>Test which is a new approach to have all
																																								                    solutions</p>
									<span class="time_date">
										11:01 AM    |    June 9</span>
								</div>
							</div>
						</div>
						<div class="outgoing_msg">
							<div class="sent_msg">
								<p>Test which is a new approach to have all
																																				                  solutions</p>
								<span class="time_date">
									11:01 AM    |    June 9</span>
							</div>
						</div>
						<div class="incoming_msg">
							<div class="incoming_msg_img">
								<img src="https://ptetutorials.com/images/user-profile.png" alt="sunil">
							</div>
							<div class="received_msg">
								<div class="received_withd_msg">
									<p>Test, which is a new approach to have</p>
									<span class="time_date">
										11:01 AM    |    Yesterday</span>
								</div>
							</div>
						</div>
						<div class="outgoing_msg">
							<div class="sent_msg">
								<p>Apollo University, Delhi, India Test</p>
								<span class="time_date">
									11:01 AM    |    Today</span>
							</div>
						</div>
						<div class="incoming_msg">
							<div class="incoming_msg_img">
								<img src="https://ptetutorials.com/images/user-profile.png" alt="sunil">
							</div>
							<div class="received_msg">
								<div class="received_withd_msg">
									<p>We work directly with our designers and suppliers,
																																								                    and sell direct to you, which means quality, exclusive
																																								                    products, at a price anyone can afford.</p>
									<span class="time_date">
										11:01 AM    |    Today</span>
								</div>
							</div>
						</div>
					</div>
					<div class="type_msg">
						<div class="input_msg_write">
							<input type="text" class="write_msg" placeholder="Type a message"/>
							<button class="msg_send_btn" type="button">
								<i class="fa fa-paper-plane-o" aria-hidden="true"></i>
							</button>
						</div>
					</div>
				</div>
			</div>


			<p class="text-center top_spac">
				Design by
				<a target="_blank" href="https://www.linkedin.com/in/sunil-rajput-nattho-singh/">Sunil Rajput</a>
			</p>

		</div>
	</div>


	<div id="chat"></div>
	<div>
		<div class="form-group">
			<label for="name">Name:</label>
			<input type="text" id="name">
		</div>
		<div class="form-group">
			<label for="message">Message:</label>
			<input type="text" id="message">
		</div>
		<button type="button" id="sendBtn">Send</button>
	</div>
{% endblock %}


{% block javascripts %}

	<script type="text/javascript">
		const socket = new WebSocket("ws://localhost:3001");

socket.addEventListener("open", function () {
console.log("CONNECTED");
});

function addMessage(name, message) {
const messageHTML = "<div class='message'><strong>" + name + ":</strong> " + message + "</div>";
document.getElementById("chat").innerHTML += messageHTML
}

socket.addEventListener("message", function (e) {
console.log(e.data);
try {
const message = JSON.parse(e.data);
addMessage(message.name, message.message);
} catch (e) { // Catch any errors
}
});


document.getElementById("sendBtn").addEventListener("click", function () {

const message = {
name: document.getElementById("name").value,
message: document.getElementById("message").value
};
socket.send(JSON.stringify(message));
addMessage(message.name, message.message);
});
	</script>

{% endblock %}
